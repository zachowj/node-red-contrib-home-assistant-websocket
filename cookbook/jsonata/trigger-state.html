<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/node-red-contrib-home-assistant-websocket/favicon.ico" size="32x32"><link rel="icon" href="/node-red-contrib-home-assistant-websocket/icon.svg" type="image/svg+xml"><title>Trigger: state | node-red-contrib-home-assistant-websocket</title><meta name="description" content="A suite of nodes that seamlessly integrates Home Assistant with Node-RED">
    <link rel="preload" href="/node-red-contrib-home-assistant-websocket/assets/style-SuLB5pJw.css" as="style"><link rel="stylesheet" href="/node-red-contrib-home-assistant-websocket/assets/style-SuLB5pJw.css">
    <link rel="modulepreload" href="/node-red-contrib-home-assistant-websocket/assets/app-CrEJ5uQ_.js"><link rel="modulepreload" href="/node-red-contrib-home-assistant-websocket/assets/trigger-state.html-vCj3djjZ.js">
    <link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/FAQ.html-dBqOPXtG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-DVwmbTUE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/action.html-YZzx3Zz9.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/breaking-changes.html-B7zthbJE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/conditionals.html-BzLCkdD6.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/development.html-3h4URyv9.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/diagnostics.html-BYJAqAoo.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/documentation.html-Q7YAJTDx.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/first-automation.html-CVqiUGEd.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-BCx9gxBt.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/migration.html-t-uVACj6.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/mustache-templates.html-DmCNTm-m.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/output-properties.html-tWtUAAkT.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/actionable-notifications-subflow-for-android.html-66G2v8bl.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/check-if-an-entity-was-turned-on-in-the-last-24-hours.html-DtYOxg7F.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-by-label.html-BT74JZst.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/expiration-date-monitor.html--ToU_uJV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-state_changed-events-based-on-area.html-CjlwfKY-.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/holiday-lights-scheduler-and-demo-mode-for-wled.html-s-zSWapB.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-BwVkdRho.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/motion-triggered-light.html-uLt-2g_J.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/play-jellyfin-show-using-sentence-node.html-D1s76JKr.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/saving-and-restoring-states.html-CfWZJ1qS.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/starting-flow-after-home-assistant-restart.html-WKIAVq6g.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sun-events.html-D5DbVzdN.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/using-date-and-time-entities-to-trigger-flows.html-DPY83DnV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/vacation-mode.html-CCqc6c6d.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/API.html-TGKNeKMJ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/action.html-lFYsuYIV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/binary-sensor.html-CMm4PGlU.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/button.html-BBO4Oplf.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/config-server.html-C_ZnLW2G.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/current-state.html-BP8HaWcQ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/device-config.html-DSeIVsF1.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/device.html-C2BwcQuE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/entity-config.html-DTaIki5g.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/entity.html-BpNWDa17.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-all.html-CtPXV6sz.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-calendar.html-027AYUJV.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-state.html-CcVBq-Ti.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/fire-event.html-B4n3_MOh.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-entities.html-CqwBQHLA.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/get-history.html-DbOJ0mOG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-CK5SRMC_.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/number.html-G2Vf5_5X.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/poll-state.html-C6KKyJaF.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/render-template.html-BukSjLQt.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/select.html-CWrHa24S.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sensor.html-BP-AV0hS.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sentence.html-CWttIXWt.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/switch.html-DFoldtbb.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/tag.html-BJx-rjO1.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/text.html-BOkk1nGG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/time-entity.html-FRlK4Og5.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/time.html-BI1OHqXZ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/trigger-state.html-DCW5LWXp.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/update-config.html-Cdx35HDQ.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/wait-until.html-DcSGxffE.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/webhook.html-Cr2P_uNI.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/zone.html-BY4bS2S7.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-CJv6V_Bm.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/exposed-nodes.html-uEjBsMim.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-w4QuZKkG.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-C49nuvQR.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/jsonata-primer.html-Zww3ACqU.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/action.html-CnNX1kE9.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/change-node.html-bYcFXZJd.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/current-state.html-DUQ_5_VB.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/events-state.html-Bl8hURue.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/functions.html-DATqTUc8.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/sensor.html-wESfQGz4.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/switch-node.html-bg3PYXmC.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/index.html-D_9G-W-y.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/404.html-D1ZwbX4A.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/DocsOnly-vwQFyUB4.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/InfoPanelOnly-B4CsnA0i.js" as="script"><link rel="prefetch" href="/node-red-contrib-home-assistant-websocket/assets/Scrubber-BxNAkqv3.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/node-red-contrib-home-assistant-websocket/"><img class="vp-site-logo" src="/node-red-contrib-home-assistant-websocket/logo-256.png" alt="node-red-contrib-home-assistant-websocket"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">node-red-contrib-home-assistant-websocket</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/guide/" aria-label="Guides"><!---->Guides<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/node/" aria-label="Nodes"><!---->Nodes<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/FAQ.html" aria-label="FAQ"><!---->FAQ<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/node-red-contrib-home-assistant-websocket/cookbook/" aria-label="Cookbook"><!---->Cookbook<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/scrubber/" aria-label="Scrubber"><!---->Scrubber<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions" aria-label="Discussions" rel="noopener noreferrer" target="_blank"><!---->Discussions<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://discord.gg/QNdsZgNBnU" aria-label="Discord" rel="noopener noreferrer" target="_blank"><!---->Discord<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket" aria-label="Github" rel="noopener noreferrer" target="_blank"><!---->Github<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/guide/" aria-label="Guides"><!---->Guides<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/node/" aria-label="Nodes"><!---->Nodes<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/FAQ.html" aria-label="FAQ"><!---->FAQ<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/node-red-contrib-home-assistant-websocket/cookbook/" aria-label="Cookbook"><!---->Cookbook<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/node-red-contrib-home-assistant-websocket/scrubber/" aria-label="Scrubber"><!---->Scrubber<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions" aria-label="Discussions" rel="noopener noreferrer" target="_blank"><!---->Discussions<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://discord.gg/QNdsZgNBnU" aria-label="Discord" rel="noopener noreferrer" target="_blank"><!---->Discord<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket" aria-label="Github" rel="noopener noreferrer" target="_blank"><!---->Github<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Cookbook <!----></p><ul class="vp-sidebar-children" style=""><!--[--><li><p tabindex="0" class="vp-sidebar-item active">JSONata <!----></p><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/action.html" aria-label="Action Node JSONata Examples"><!---->Action Node JSONata Examples<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/change-node.html" aria-label="Change node"><!---->Change node<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/current-state.html" aria-label="Current State"><!---->Current State<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/events-state.html" aria-label="Events: state"><!---->Events: state<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/functions.html" aria-label="Other functions"><!---->Other functions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/sensor.html" aria-label="Sensor"><!---->Sensor<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/switch-node.html" aria-label="Switch node"><!---->Switch node<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/trigger-state.html" aria-label="Trigger: state"><!---->Trigger: state<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/motion-triggered-light.html" aria-label="Motion Triggered Light"><!---->Motion Triggered Light<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/saving-and-restoring-states.html" aria-label="Saving and Restoring States"><!---->Saving and Restoring States<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/get-state_changed-events-based-on-area.html" aria-label="Get state_changed Events Based on Area"><!---->Get state_changed Events Based on Area<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/sun-events.html" aria-label="Turn Light On/Off with Sunset/Sunrise"><!---->Turn Light On/Off with Sunset/Sunrise<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/vacation-mode.html" aria-label="Vacation Mode"><!---->Vacation Mode<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/expiration-date-monitor.html" aria-label="Expiration Date Monitor with notification"><!---->Expiration Date Monitor with notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/using-date-and-time-entities-to-trigger-flows.html" aria-label="Using Date and Time entities to trigger flows"><!---->Using Date and Time entities to trigger flows<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/check-if-an-entity-was-turned-on-in-the-last-24-hours.html" aria-label="Check if an entity was a certain state in the last 24 hours"><!---->Check if an entity was a certain state in the last 24 hours<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/starting-flow-after-home-assistant-restart.html" aria-label="Starting a flow after a Home Assistant restart"><!---->Starting a flow after a Home Assistant restart<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/holiday-lights-scheduler-and-demo-mode-for-wled.html" aria-label="Holiday lights scheduler and demo mode for WLED"><!---->Holiday lights scheduler and demo mode for WLED<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/node-red-contrib-home-assistant-websocket/cookbook/actionable-notifications-subflow-for-android.html" aria-label="Actionable Notifications Subflow for Android"><!---->Actionable Notifications Subflow for Android<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="trigger-state" tabindex="-1"><a class="header-anchor" href="#trigger-state"><span>Trigger: state</span></a></h1><p>The <strong>Trigger: state</strong> node is very similar to the <em>Events: state</em> node. It will trigger when a given entity state changes, but unlike the <em>Events: state</em>, the <em>Trigger: state</em> node has the opportunity to add conditions using UI fields to construct complex tests. This removes much of the need to manage conditional tests using JSONata.</p><p>JSONata <em>can</em> be used in several places within this node. However real practical use is quite limited. Although the Trigger node has extensive conditional testing included as UI setting, it does not have access to the $entity() or $entities() function in the conditions. The example given here is rather simplistic and contrived to demonstrate that JSONata can be used, rather than focusing on a genuinue or realistic use-case.</p><p><img src="/node-red-contrib-home-assistant-websocket/assets/jsonata_4_1-CfZXdRrw.png" alt="screenshot"></p><p><strong>Example:</strong> Respond every five minutes during the hour before and hour after sunset.</p><div class="language-json" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Trigger: state node - respond to state changes&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;style&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#000000&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;nodes&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;320b22abb5a9ea96&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;da88972398c7ed97&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c2d9f44ffe436dcc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2144de490d4257d7&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;94ceadbce4b45cdf&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;79b056d9779ec8f1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;360fe19e1e203539&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;247cbab5f584ea63&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;0509fc220ff7735e&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;8fc293f5015dd3d5&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1359</span><span class="token punctuation">,</span><span class="token property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">872</span><span class="token punctuation">,</span><span class="token property">&quot;h&quot;</span><span class="token operator">:</span><span class="token number">302</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;320b22abb5a9ea96&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;inject&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Testing&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;props&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;p&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;repeat&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;crontab&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;once&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;onceDelay&quot;</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;payload&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\t   \&quot;entity_id\&quot;: \&quot;sensor.time_utc\&quot;,\t   \&quot;old_state\&quot;: {\&quot;state\&quot;: \&quot;16:49\&quot;},\t   \&quot;new_state\&quot;: {\&quot;state\&quot;: \&quot;16:50\&quot;}\t}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;payloadType&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;da88972398c7ed97&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;da88972398c7ed97&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;trigger-state&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Actions around sunset&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;server&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token property">&quot;inputs&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;outputs&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;exposeAsEntityConfig&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;entityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;sensor.time_utc&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;entityIdType&quot;</span><span class="token operator">:</span><span class="token string">&quot;exact&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;debugEnabled&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;constraints&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;this_entity&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetValue&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;propertyType&quot;</span><span class="token operator">:</span><span class="token string">&quot;current_state&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;propertyValue&quot;</span><span class="token operator">:</span><span class="token string">&quot;new_state.state&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorType&quot;</span><span class="token operator">:</span><span class="token string">&quot;includes&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorValueDatatype&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorValue&quot;</span><span class="token operator">:</span><span class="token string">&quot;(\t/* UTC sunrise &amp; sunset to 5 mins, month average (London UK) */\t/* Jan-Dec, Feb-Nov, Mar-Oct, Apr-Sep, May-Aug, Jun-Jly      */\t    $times:=[[\&quot;07:55\&quot;, \&quot;16:20\&quot;],\t             [\&quot;07:15\&quot;, \&quot;16:45\&quot;],\t             [\&quot;06:00\&quot;, \&quot;17:35\&quot;],\t             [\&quot;05:15\&quot;, \&quot;18:30\&quot;],\t             [\&quot;04:30\&quot;, \&quot;19:30\&quot;],\t             [\&quot;04:05\&quot;, \&quot;20:05\&quot;]];\t\t/* get this month (Jan=0), lookup sun-times table, return sun rise-set for this month */\t    $mtable:=[0..11].$min([$, $abs($-11)]);\t    $mindex:=$now(&#39;[M]&#39;).$number()-1;\t\t/* get sunset and build array of condition test-times around this */\t    $sunset:=($times[$mtable[$mindex]])[1];\t    $h:=$number($substringBefore($sunset, \&quot;:\&quot;));\t    $m:=$number($substringAfter($sunset, \&quot;:\&quot;));\t\t/* for span period mins, generate array of times and select every nth */\t    $span:=60;\t    $nth:=5;\t\t    $t:=$h*60+$m-$span;\t    ([$t..$t+$span*2])#$i.(\t        $h:=$floor($/60);\t        $m:=$%60;\t        $i%$nth=0 ? $formatInteger($h,&#39;99&#39;) &amp; \&quot;:\&quot; &amp; $formatInteger($m, &#39;99&#39;);\t    )\t)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;customOutputs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;messageType&quot;</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;messageValue&quot;</span><span class="token operator">:</span><span class="token string">&quot;(\t    $sunset:=$entities(&#39;sensor.sun_next_setting&#39;).state;\t    $togo:= ($toMillis($sunset)-$millis())/60000~&gt;$floor();\t    $toset:= $togo &lt; 180 ? $togo : $togo-1440;\t    $x:= $toset-25;\t    $pc:= $x&lt;0 and $x&gt;-55 ? $min([$abs($x)*2, 100]) : null;\t\t    {\&quot;topic\&quot;: \&quot;Minutes to Sunset\&quot;,\t     \&quot;payload\&quot;: $toset,\t     \&quot;time\&quot;: $entities(&#39;sensor.time&#39;).state,\t     \&quot;sunset\&quot;: $sunset,\t     \&quot;percent\&quot;: $pc\t    }\t)&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;messageValueType&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorPropertyType&quot;</span><span class="token operator">:</span><span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorPropertyValue&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorType&quot;</span><span class="token operator">:</span><span class="token string">&quot;is&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorValue&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;comparatorValueDataType&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;outputInitially&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;stateType&quot;</span><span class="token operator">:</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;enableInput&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1440</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;c2d9f44ffe436dcc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;2144de490d4257d7&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;247cbab5f584ea63&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;c2d9f44ffe436dcc&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Every 5 mins around sunset&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;active&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tosidebar&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;console&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tostatus&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;complete&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusVal&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusType&quot;</span><span class="token operator">:</span><span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">580</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;2144de490d4257d7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;switch&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Sunset Actions&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;propertyType&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;btwn&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vt&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v2&quot;</span><span class="token operator">:</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v2t&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;btwn&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vt&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v2&quot;</span><span class="token operator">:</span><span class="token string">&quot;14&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v2t&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;btwn&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;vt&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v2&quot;</span><span class="token operator">:</span><span class="token string">&quot;-30&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;v2t&quot;</span><span class="token operator">:</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;else&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;checkall&quot;</span><span class="token operator">:</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repair&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;outputs&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">540</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1480</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;94ceadbce4b45cdf&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;79b056d9779ec8f1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;360fe19e1e203539&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;94ceadbce4b45cdf&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;At Sunset&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;active&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tosidebar&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;console&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tostatus&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;complete&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusVal&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusType&quot;</span><span class="token operator">:</span><span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">780</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1440</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;79b056d9779ec8f1&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Just Before&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;active&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tosidebar&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;console&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tostatus&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;complete&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusVal&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusType&quot;</span><span class="token operator">:</span><span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">790</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1500</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;360fe19e1e203539&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Just After&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;active&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tosidebar&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;console&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;tostatus&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;complete&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;targetType&quot;</span><span class="token operator">:</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusVal&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;statusType&quot;</span><span class="token operator">:</span><span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">780</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1560</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;247cbab5f584ea63&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Brightness 0-100% over 50 min&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;p&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;pt&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\t    \&quot;domain\&quot;: \&quot;homeassistant\&quot;,\t    \&quot;service\&quot;: \&quot;turn_on\&quot;,\t    \&quot;target\&quot;: {\t        \&quot;entity_id\&quot;: [\&quot;light.front_door\&quot;, \&quot;switch.hall_light\&quot;]\t        },\t    \&quot;data\&quot;: {\t        \&quot;brightness_pct\&quot;: percent\t    }\t}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tot&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;action&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;reg&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">310</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1620</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;8fc293f5015dd3d5&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;0509fc220ff7735e&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;api-call-service&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;server&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;debugenabled&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;domain&quot;</span><span class="token operator">:</span><span class="token string">&quot;homeassistant&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;service&quot;</span><span class="token operator">:</span><span class="token string">&quot;turn_on&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;areaId&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;deviceId&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;entityId&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;dataType&quot;</span><span class="token operator">:</span><span class="token string">&quot;jsonata&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;mergeContext&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;mustacheAltTags&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;outputProperties&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;queue&quot;</span><span class="token operator">:</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">760</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1620</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;8fc293f5015dd3d5&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;switch&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;z&quot;</span><span class="token operator">:</span><span class="token string">&quot;776c027950fc8c3f&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;g&quot;</span><span class="token operator">:</span><span class="token string">&quot;3a2face9747195a7&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;Not null&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;property&quot;</span><span class="token operator">:</span><span class="token string">&quot;payload.data.brightness_pct&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;propertyType&quot;</span><span class="token operator">:</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;t&quot;</span><span class="token operator">:</span><span class="token string">&quot;nnull&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;checkall&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;repair&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;outputs&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">540</span><span class="token punctuation">,</span><span class="token property">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">1620</span><span class="token punctuation">,</span><span class="token property">&quot;wires&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;0509fc220ff7735e&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div><p>Sunrise and sunset times are often critical to running automations, and Home Assistant has inbuilt entities that provide the next dawn, sunrise, dusk, and sunset times. In order to be able to respond to <em>multiple</em> events during the period both before and after sunset, it is necessary to trigger at a more regular interval, not just on the sun-events, and then to test for required times or periods before and after sunset.</p><p>The <em>Trigger: state</em> node can be set to use the <code>sensor.time_utc</code> entity as the subject of the node. This sensor holds UTC time as &quot;hh:mm&quot;, and will change every minute, thus triggering a state change at regular 60 second intervals. We can add conditions to test the time against an <em>expected</em> period around sunset, and to generate a <em>customised output</em> that includes given periods or times before or after sunset. Combined with a <em>Switch</em> node this permits multiple tests and multiple automation events to be actioned.</p><h3 id="using-jsonata-to-set-a-condition-value" tabindex="-1"><a class="header-anchor" href="#using-jsonata-to-set-a-condition-value"><span>Using JSONata to set a <em>condition value</em></span></a></h3><p>Here JSONata is used to generate an array of times of interest. When the trigger entity state, UTC time &quot;hh:mm&quot;, is included in the calculated array, the condition is met and a message will be output.</p><p>Since JSONata does not have access to the $entities() function in this particular UI field, the code here is used to generate a period of interest based on hard-coded sunrise and sunset times according to the current month. This is not ideal, but does demonstrate how JSONata can be used to easily generate and manipulate various JSON structures.</p><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">(</span>
<span class="line">/* UTC sunrise &amp; sunset to 5 mins, month average (London UK) */</span>
<span class="line">/* Jan-Dec, Feb-Nov, Mar-Oct, Apr-Sep, May-Aug, Jun-Jly      */</span>
<span class="line">    $times:=[[&quot;07:55&quot;, &quot;16:20&quot;],</span>
<span class="line">             [&quot;07:15&quot;, &quot;16:45&quot;],</span>
<span class="line">             [&quot;06:00&quot;, &quot;17:35&quot;],</span>
<span class="line">             [&quot;05:15&quot;, &quot;18:30&quot;],</span>
<span class="line">             [&quot;04:30&quot;, &quot;19:30&quot;],</span>
<span class="line">             [&quot;04:05&quot;, &quot;20:05&quot;]];</span>
<span class="line"></span>
<span class="line">/* get this month (Jan=0), lookup sun-times table, return sun rise-set for this month */</span>
<span class="line">    $mtable:=[0..11].$min([$, $abs($-11)]);</span>
<span class="line">    $mindex:=$now(&#39;[M]&#39;).$number()-1;</span>
<span class="line"></span>
<span class="line">/* get sunset and build array of condition test-times around this */</span>
<span class="line">    $sunset:=($times[$mtable[$mindex]])[1];</span>
<span class="line">    $h:=$number($substringBefore($sunset, &quot;:&quot;));</span>
<span class="line">    $m:=$number($substringAfter($sunset, &quot;:&quot;));</span>
<span class="line"></span>
<span class="line">/* for span period mins, generate array of times and select every nth */</span>
<span class="line">    $span:=60;</span>
<span class="line">    $nth:=5;</span>
<span class="line"></span>
<span class="line">    $t:=$h*60+$m-$span;</span>
<span class="line">    ([$t..$t+$span*2])#$i.(</span>
<span class="line">        $h:=$floor($/60);</span>
<span class="line">        $m:=$%60;</span>
<span class="line">        $i%$nth=0 ? $formatInteger($h,&#39;99&#39;) &amp; &quot;:&quot; &amp; $formatInteger($m, &#39;99&#39;);</span>
<span class="line">    )</span>
<span class="line">)</span>
<span class="line"></span></code></pre></div><p>This code uses the current month to lookup a given sunset time, and then to generate an array of times either side of expected sunset, using a given span in minutes, and then picking out every five minutes only.</p><p><em>The figures provided are examples, based on UTC times (DST ignored) for location London, UK and estimate an average sunrise and sunset time for each calendar month. Since sun events can move by up to one hour from start to end of a month, a span of at least 30 minutes is required to successfully include events across the entire month.</em></p><h3 id="using-jsonata-to-create-a-custom-message" tabindex="-1"><a class="header-anchor" href="#using-jsonata-to-create-a-custom-message"><span>Using JSONata to create a <em>custom message</em></span></a></h3><p>The output properties on successful trigger include a default message and a default payload, which includes the basic event details for the trigger entity. It is possible to set the output as a <em>customised payload</em>, which replaces msg.payload with specific output, or as a <em>customised message</em>, which replaces the entire message with a generated object.</p><div class="language-text" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">(</span>
<span class="line">    $sunset:=$entities(&#39;sensor.sun_next_setting&#39;).state;</span>
<span class="line">    $togo:= ($toMillis($sunset)-$millis())/60000~&gt;$floor();</span>
<span class="line">    $toset:= $togo &lt; 180 ? $togo : $togo-1440;</span>
<span class="line">    $x:= $toset-25;</span>
<span class="line">    $pc:= $x&lt;0 and $x&gt;-55 ? $min([$abs($x)*2, 100]) : null;</span>
<span class="line"></span>
<span class="line">    {&quot;topic&quot;: &quot;Minutes to Sunset&quot;,</span>
<span class="line">     &quot;payload&quot;: $toset,</span>
<span class="line">     &quot;time&quot;: $entities(&#39;sensor.time&#39;).state,</span>
<span class="line">     &quot;sunset&quot;: $sunset,</span>
<span class="line">     &quot;percent&quot;: $pc</span>
<span class="line">    }</span>
<span class="line">)</span>
<span class="line"></span></code></pre></div><p>The <code>$entities()</code> function is available in JSONata in the output properties UI field, which means that both current time and sunset time can be obtained and compared. This allows some simple JSONata code to generate a complete message object, including <em>msg.topic</em> and <em>msg.payload</em> with the exact minutes to the next sunset correctly calculated.</p><p>For automation, all that is required is a following <em>Switch</em> node set to route on a message property, for example <em>msg.payload</em> as minutes to next sunset between 0 and 4 (based on a five minute trigger interval) so as to be able to run an automation just as sunset is about to take place (with a five minute discrimination).</p><p>As a further example, the JSONata output calculates a percentage value going from 0 to 100 over the period 25 minutes before to 25 minutes after sunset, with the percentage value set to &#39;null&#39; outside this time. The <em>Change</em> node following also uses JSONata to create the entire <em>Service Call</em> node input settings, to turn on a group of lights in an timed-incremental fashion.</p><p><strong>Also see:</strong></p><ul><li><a class="route-link" href="/node-red-contrib-home-assistant-websocket/guide/jsonata/">JSONata guide</a></li><li><a class="route-link" href="/node-red-contrib-home-assistant-websocket/guide/jsonata/jsonata-primer.html">JSONata primer</a></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/edit/main/docs/cookbook/jsonata/trigger-state.md" aria-label="Help us improve this page!" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Help us improve this page!<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 37859597+zachowj@users.noreply.github.com">Jason</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/node-red-contrib-home-assistant-websocket/cookbook/jsonata/switch-node.html" aria-label="Switch node"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Switch node</span></div></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/node-red-contrib-home-assistant-websocket/assets/app-CrEJ5uQ_.js" defer></script>
  </body>
</html>
